@model DentalManagement.Models.TreatmentType

<div class="container mt-4">
    <div class="card shadow">
        <div class="card-header bg-primary text-white">
            <h2 class="mb-0">Create Treatment Type</h2>
        </div>
        <div class="card-body">
            <form asp-action="Create" class="needs-validation" novalidate>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="form-group">
                            <label class="form-label">Treatment Template</label>
                            <select id="treatmentTemplate" class="form-select mb-2">
                                <option value="" selected>-- Select a template or create custom --</option>
                                <option value="cleaning">Dental Cleaning</option>
                                <option value="rootcanal">Root Canal</option>
                                <option value="extraction">Tooth Extraction</option>
                                <option value="implant">Dental Implant</option>
                                <option value="braces">Braces Installation</option>
                                <option value="whitening">Teeth Whitening</option>
                                <option value="filling">Dental Filling</option>
                                <option value="crown">Dental Crown</option>
                            </select>
                            <small class="text-muted">Select a template or create a custom treatment below</small>
                        </div>
                    </div>
                </div>

                <hr class="my-4">

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="form-group">
                            <label class="form-label">Name <span class="text-danger">*</span></label>
                            <input asp-for="Name" class="form-control" required />
                            <div class="invalid-feedback">Please enter a treatment name</div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="form-group">
                            <label class="form-label">Price ($) <span class="text-danger">*</span></label>
                            <input asp-for="Price" type="number" step="0.01" class="form-control" required />
                            <div class="invalid-feedback">Please enter a valid price</div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="form-group">
                            <label class="form-label">Duration (Minutes) <span class="text-danger">*</span></label>
                            <input asp-for="Duration" type="number" class="form-control" required />
                            <div class="invalid-feedback">Please enter the duration in minutes</div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="form-group">
                            <label class="form-label">Active Status</label>
                            <select asp-for="IsActive" class="form-select">
                                <option value="true">Active</option>
                                <option value="false">Inactive</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12 mb-3">
                        <div class="form-group">
                            <label class="form-label">Description</label>
                            <textarea asp-for="Description" class="form-control" rows="3"></textarea>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12 mb-3">
                        <div class="form-group">
                            <label class="form-label">Assign Doctors <span class="text-danger">*</span></label>
                            <select name="DoctorIds" class="form-select" multiple asp-items="ViewBag.DoctorIds" required>
                            </select>
                            <small class="text-muted">Hold Ctrl/Cmd to select multiple doctors</small>
                            <div class="invalid-feedback">Please assign at least one doctor</div>
                        </div>
                    </div>
                </div>

                <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                    <a asp-action="Index" class="btn btn-outline-secondary me-md-2">Cancel</a>
                    <button type="submit" class="btn btn-primary">Save Treatment</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Form validation
        (function () {
            'use strict'
            var forms = document.querySelectorAll('.needs-validation')
            Array.prototype.slice.call(forms)
                .forEach(function (form) {
                    form.addEventListener('submit', function (event) {
                        if (!form.checkValidity()) {
                            event.preventDefault()
                            event.stopPropagation()
                        }
                        form.classList.add('was-validated')
                    }, false)
                })
        })()

        // Treatment template functionality
        document.getElementById('treatmentTemplate').addEventListener('change', function() {
            const template = this.value;
            const nameInput = document.querySelector('[name="Name"]');
            const priceInput = document.querySelector('[name="Price"]');
            const durationInput = document.querySelector('[name="Duration"]');
            const descriptionInput = document.querySelector('[name="Description"]');
            
            // Reset if empty selection
            if (!template) {
                nameInput.value = '';
                priceInput.value = '';
                durationInput.value = '';
                descriptionInput.value = '';
                return;
            }
            
            // Set values based on template
            switch(template) {
                case 'cleaning':
                    nameInput.value = 'Dental Cleaning';
                    priceInput.value = '120.00';
                    durationInput.value = '60';
                    descriptionInput.value = 'Regular dental cleaning and check-up to remove plaque and tartar.';
                    break;
                case 'rootcanal':
                    nameInput.value = 'Root Canal';
                    priceInput.value = '800.00';
                    durationInput.value = '120';
                    descriptionInput.value = 'Endodontic treatment for infected tooth pulp to save the natural tooth.';
                    break;
                case 'extraction':
                    nameInput.value = 'Tooth Extraction';
                    priceInput.value = '250.00';
                    durationInput.value = '45';
                    descriptionInput.value = 'Removal of damaged or problematic teeth that cannot be saved.';
                    break;
                case 'implant':
                    nameInput.value = 'Dental Implant';
                    priceInput.value = '1500.00';
                    durationInput.value = '180';
                    descriptionInput.value = 'Surgical component that interfaces with the bone to support dental prosthesis.';
                    break;
                case 'braces':
                    nameInput.value = 'Braces Installation';
                    priceInput.value = '3000.00';
                    durationInput.value = '120';
                    descriptionInput.value = 'Orthodontic treatment to align teeth and correct bite issues.';
                    break;
                case 'whitening':
                    nameInput.value = 'Teeth Whitening';
                    priceInput.value = '350.00';
                    durationInput.value = '90';
                    descriptionInput.value = 'Professional teeth whitening to remove stains and discoloration.';
                    break;
                case 'filling':
                    nameInput.value = 'Dental Filling';
                    priceInput.value = '200.00';
                    durationInput.value = '45';
                    descriptionInput.value = 'Restoration of decayed teeth using composite or amalgam materials.';
                    break;
                case 'crown':
                    nameInput.value = 'Dental Crown';
                    priceInput.value = '950.00';
                    durationInput.value = '90';
                    descriptionInput.value = 'Custom-fitted cap that covers a damaged or weak tooth to restore its shape and function.';
                    break;
            }
        });
    </script>
}